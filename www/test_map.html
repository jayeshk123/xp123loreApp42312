<!DOCTYPE html>
<html>
 <head>
  <meta charset='utf-8' />
  <title></title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src="https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js"></script>
   <script src="https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js"></script>
   </head>
   
   
   <body>
   
   
   <div id='map'></div>
   <div id='geolocate' class='ui-button'>
   <a href='#'>Find me</a>
   </div>
   
   
   <pre id='distance' class='ui-distance'>Click to place a marker</pre>
   
   
   </body>
   <script>
    L.mapbox.accessToken = 'pk.eyJ1IjoiYWJ6YWwiLCJhIjoiY2llempiaW9oMWJvdXNnbTAxZnY4NTNvOSJ9.I0bW1wxrOYS2MPZD0FrTtA';
    var map = L.mapbox.map('map', 'mapbox.streets')
    .setView([38.9, -77], 12);
    
    // Create a featureLayer that will hold a marker and linestring.
    var featureLayer = L.mapbox.featureLayer().addTo(map);
    var secondFeatureLayer = L.mapbox.featureLayer().addTo(map);
    
    // 1. Let's create a counter so that we can record the separate clicks
    var counter = 0;
    
    // 2. Let's use some variables outside the function scope
    var c,
    c2,
    prevClick;
    
    map.on('click', function(ev) {
           
           // 3. Check if we've yet to click once
           if (counter < 1) {
           
           // 4. assign current click coordinates to prevClick for later use
           prevClick = ev.latlng;
           
           // ev.latlng gives us the coordinates of
           // the spot clicked on the map.
           c = ev.latlng;
           
           counter++;
           } else {
           c = prevClick;
           counter = 0;
           }
           
           c2 = ev.latlng;
           
           var geojson = [
                          {
                          "type": "Feature",
                          "geometry": {
                          "type": "Point",
                          "coordinates": [c.lng, c.lat]
                          },
                          "properties": {
                          "marker-color": "#ff8888"
                          }
                          },
                          {
                          "type": "Feature",
                          "geometry": {
                          "type": "Point",
                          "coordinates": [c2.lng, c2.lat]
                          },
                          "properties": {
                          "marker-color": "#ff8888"
                          }
                          },{
                          "type": "Feature",
                          "geometry": {
                          "type": "LineString",
                          "coordinates": [
                                          [c.lng, c.lat],
                                          [c2.lng, c2.lat]
                                          ]
                          },
                          "properties": {
                          "stroke": "#000",
                          "stroke-opacity": 0.5,
                          "stroke-width": 4
                          }
                          }
                          ];
           
           secondFeatureLayer.setGeoJSON(geojson);
           
           // Finally, print the distance between these two points
           // on the screen using distanceTo().
           var container = document.getElementById('distance');
           container.innerHTML = (c2.distanceTo(c)).toFixed(0) + 'm';
           });
           
           
           var geolocate = document.getElementById('geolocate');
           console.log(geolocate);
           if (!navigator.geolocation) {
            geolocate.innerHTML = 'Geolocation is not available';
           } else {
            geolocate.onclick = function (e) {
             e.preventDefault();
             e.stopPropagation();
             map.locate();
            };
           }
   
   // Once we've got a position, zoom and center the map
   // on it, and add a single marker.
   map.on('locationfound', function(e) {
          map.fitBounds(e.bounds);
          
          featureLayer.setGeoJSON({
                                  type: 'Feature',
                                  geometry: {
                                  type: 'Point',
                                  coordinates: [e.latlng.lng, e.latlng.lat]
                                  },
                                  properties: {
                                  'title': 'Here I am!',
                                  'marker-color': '#ff8888',
                                  'marker-symbol': 'star'
                                  }
                                  });
          
          // And hide the geolocation button
          geolocate.parentNode.removeChild(geolocate);
          
          
          
          });
          // If the user chooses not to allow their location
          // to be shared, display an error message.
          map.on('locationerror', function() {
                 geolocate.innerHTML = 'Position could not be found';
                 });
                     </script>
   <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
    
    pre.ui-distance {
     position:absolute;
     bottom:10px;
     left:10px;
     padding:5px 10px;
     background:rgba(0,0,0,0.5);
     color:#fff;
     font-size:11px;
     line-height:18px;
     border-radius:3px;
    }
   .ui-button {
    background:#3887BE;
    color:#FFF;
    display:block;
    position:absolute;
    top:50%;left:50%;
    width:160px;
    margin:-20px 0 0 -80px;
    z-index:100;
    text-align:center;
    padding:10px;
    border:1px solid rgba(0,0,0,0.4);
    border-radius:3px;
   }
   .ui-button:hover {
    background:#3074a4;
    color:#fff;
   }
   </style>
   
   </html>